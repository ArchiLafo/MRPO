В этом примере мы создали таблицу "products" и класс Product, который определяет структуру нашей таблицы. Затем мы создали класс ProductRepository, который реализует интерфейс IRepository и предоставляет методы для взаимодействия с таблицей "products". Кроме того, мы создали базу данных SQLite и использовали сессию SQLAlchemy для добавления продукта в таблицу.

В первой строке мы импортируем класс sessionmaker из модуля sqlalchemy.orm. Этот класс отвечает за создание сессии, которая позволяет взаимодействовать с базой данных.

Затем мы импортируем различные функции и классы из модуля sqlalchemy. В частности, create_engine - функция для создания движка базы данных, а Column, Integer, String и Float - классы для описания столбцов таблицы.

И, наконец, мы импортируем функцию declarative_base из sqlalchemy.ext.declarative, которая является фабрикой для создания базового класса моделей данных.


С помощью функции declarative_base мы создаем базовый класс моделей данных, который будет использоваться для описания таблиц в базе данных.



 Мы создаем класс Product, который наследуется от базового класса Base. Затем мы определяем имя таблицы в базе данных с помощью атрибута __tablename__. В данном случае имя таблицы будет "products".

Далее мы определяем столбцы таблицы. У каждого столбца есть имя, тип данных и, возможно, дополнительные параметры. Например, для столбца id мы указываем, что он является первичным ключом (primary_key=True), а для столбца name указываем, что он не может принимать значение NULL (nullable=False).


С помощью функции create_engine мы создаем движок базы данных, который будет использоваться для взаимодействия с базой данных. В данном случае мы создаем базу данных SQLite с именем "shop.db".

Затем мы используем метод create_all у базового класса моделей данных, чтобы создать таблицу в базе данных.

Дальше в коде определен класс ProductRepository, который является наследником абстрактного класса IRepository. В нем определены методы add, delete, update, get и get_all. Внутри каждого метода выполняется операция с базой данных через объект session, полученный из экземпляра класса Database, переданного в конструкторе ProductRepository.

Для выполнения операций с базой данных используется объект session, созданный с помощью метода get_session класса Database. Методы add, delete, update выполняют соответствующие операции в рамках транзакции, которую затем необходимо зафиксировать вызовом метода commit. Метод get возвращает объект из базы данных по его идентификатору, а метод get_all возвращает все объекты из базы данных.

Все объекты, которые могут быть сохранены в базе данных, определены в классах, которые наследуются от класса Base модуля sqlalchemy.ext.declarative. В данном случае определен класс Product.



id: идентификатор товара;
name: название товара;
description: описание товара;
price: цена товара;





Также в коде определен класс Database, который является своеобразной оберткой над sqlalchemy и инкапсулирует создание и работу с базой данных. В классе определены методы __init__, create_all, drop_all, get_session, _create_session и add. Метод __init__ создает подключение к базе данных, методы create_all и drop_all создают и удаляют все таблицы в базе данных соответственно, методы get_session и _create_session создают объект session для работы с базой данных, а метод add добавляет объект в базу данных и сохраняет изменения.
